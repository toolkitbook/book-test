---
layout: default
title: C++ Toolkit test
nav: pages/ch_build
---

<span class="label">5</span>Working with Makefiles
==================================================

Last Update: September 26, 2014.

Overview
--------

The overview for this chapter consists of the following topics:

-   Introduction

-   Chapter Outline

### Introduction

Building executables and libraries for a large, integrated set of software tools such as the C++ Toolkit, and doing so consistently on different platforms and architectures, is a daunting task. Therefore, the Toolkit developers have expended considerable effort to design a build system based upon the <span class="nctnt ncbi-app">make</span> utility as controlled by <span class="nctnt ncbi-monospace">makefiles</span>. Although it is, of course, possible to write one's own Toolkit <span class="nctnt ncbi-monospace">makefile</span> from scratch, it is seldom desirable. To take advantage of the experience, wisdom, and alchemy invested in Toolkit and to help avoid often inscrutable compilation issues:

> **We strongly advise users to work with the Toolkit's make system.**

With minimal manual editing (and after invoking the [configure](ch_config.html) script in your build tree), the build system adapts to your environment, compiler options, defines all relevant <span class="nctnt ncbi-monospace">makefile</span> macros and targets, allows for recursive builds of the entire Toolkit and targeted builds of single modules, and handles many other details that can confound manual builds.

### Chapter Outline

The following is an outline of the topics presented in this chapter:

-   [Major Makefiles](#major-makefiles-)

-   [Makefile Hierarchy](#makefile-hierarchy-)

-   [Meta-Makefiles](#meta-makefiles)

    -   [Makefile.in Meta Files](#makefilein-meta-files)

    -   [Expendable Projects](#expendable-projects)

-   [Project Makefiles](#project-makefiles-)

    -   [List of Optional Packages, Features, and Projects](#list-of-optional-packages-features-and-projects)

-   [Standard Build Targets](#standard-build-targets-)

    -   [Meta-Makefile Targets](#meta-makefile-targets)

    -   [Makefile Targets](#makefile-targets)

-   [Makefile Macros and Makefile.mk](#makefile-macros-and-makefilemk)

-   [Example Makefiles](#example-makefiles-)

For information on configuring and building that isn't specific to makefiles, see the chapters on [configuring](ch_config.html) and [managing projects](ch_proj.html).

Major Makefiles
---------------

The C++ Toolkit build system was based on the "GNU build system", which employs a configure script and makefiles. Before describing the C++ Toolkit build system in detail, we list the major types of makefiles used by the Toolkit:

-   **Meta-makefiles**. These files exist for each project and tie the project together in the Toolkit hierarchy; defining those applications and libraries as a project is necessary for (possibly recursively) building.

-   **Generic makefile templates** (<span class="nctnt ncbi-path">Makefile\*.in</span>). The <span class="nctnt ncbi-app">configure</span> script processes these files from the src hierarchy to substitute for the special tags <span class="nctnt ncbi-var">"@some\_name@"</span> and make other specializations required for a given project. Note that meta-makefiles are typically derived from such templates.

-   **Customized makefiles** (<span class="nctnt ncbi-path">Makefile.\*.[lib\\|app]</span>). For each library or application, this file gives specific targets, compiler flags, and other project-specific build instructions. These files appear in the <span class="nctnt ncbi-path">src</span> hierarchy.

-   **Configured makefiles** (<span class="nctnt ncbi-path">Makefile</span> or <span class="nctnt ncbi-path">Makefile.\*\_[lib\\|app]</span>). A makefile generated by <span class="nctnt ncbi-app">configure</span> for each project and sub-project and placed in the appropriate location in the build tree ready for use will be called a "configured makefile". Note that meta-makefiles in the build tree may be considered “configured”.

Makefile Hierarchy
------------------

All Toolkit <span class="nctnt ncbi-monospace">makefiles</span> reside in either the <span class="nctnt ncbi-path">src</span> directory as templates or customized files, or in the appropriate configured form in each of your <span class="nctnt ncbi-path">\<builddir\></span> hierarchies as illustrated in [Figure 1](#figure-1)

[![Figure 1. Makefile hierarchy.](/book-test/static/img/make.gif)](/book-test/static/img/make.gif "Click to see the full-resolution image")

Figure 1. Makefile hierarchy.

Most of the files listed in [Figure 1](#figure-1) are templates from the <span class="nctnt ncbi-path">src</span> directory, with each corresponding <span class="nctnt ncbi-monospace">configured makefile</span> at the top of the build tree. Of these, <span class="nctnt ncbi-path">\<builddir\>/Makefile</span> can be considered the master <span class="nctnt ncbi-monospace">makefile</span> in that it can recursively build the entire Toolkit. The role of each top-level <span class="nctnt ncbi-monospace">makefile</span> template is summarized as follows:

-   <span class="nctnt ncbi-path">Makefile.in</span> - makefile to perform a recursive build in all project subdirectories.

-   <span class="nctnt ncbi-path">Makefile.meta.in</span> - included by all makefiles that provide both local and recursive builds.

-   <span class="nctnt ncbi-path">Makefile.mk.in</span> - included by all makefiles; sets a lot of configuration variables.

-   <span class="nctnt ncbi-path">Makefile.lib.in</span> - included by all makefiles that perform a "standard" library build, when building only static libraries.

-   <span class="nctnt ncbi-path">Makefile.dll.in</span> - included by all makefiles that perform a "standard" library build, when building only shared libraries.

-   <span class="nctnt ncbi-path">Makefile.both.in</span> - included by all makefiles that perform a "standard" library build, when building both static and shared libraries.

-   <span class="nctnt ncbi-path">Makefile.lib.tmpl.in</span> - serves as a template for the project <span class="nctnt ncbi-monospace">customized makefiles</span> (<span class="nctnt ncbi-path">Makefile.\*.lib[.in]</span>) that perform a "standard" library build.

-   <span class="nctnt ncbi-path">Makefile.app.in</span> - included by all makefiles that perform a "standard" application build.

-   <span class="nctnt ncbi-path">Makefile.app.tmpl.in</span> - serves as a template for the project <span class="nctnt ncbi-monospace">customized makefiles</span> (<span class="nctnt ncbi-path">Makefile.\*.app[.in]</span>) that perform a "standard" application build.

-   <span class="nctnt ncbi-path">Makefile.rules.in, Makefile.rules\_with\_autodep.in</span> -- instructions for building object files; included by most other makefiles.

The project-specific portion of the <span class="nctnt ncbi-monospace">makefile</span> hierarchy is represented in the figure by the <span class="nctnt ncbi-monospace">meta-makefile</span> template <span class="nctnt ncbi-path">c++/src/myProj/Makefile.in</span>, the customized makefile <span class="nctnt ncbi-path">c++/src/myProj/Makefile.myProj.[app\\|lib]</span> (not shown), and the configured makefile <span class="nctnt ncbi-path">c++/myBuild/build/myProj/Makefile</span>. In fact, every project and sub-project in the Toolkit has analogous files specialized to its project; in most circumstances, every new or user project should emulate this file structure to be compatible with the make system.

Meta-Makefiles
--------------

A typical <span class="nctnt ncbi-monospace">meta-makefile</span> template (e.g. <span class="nctnt ncbi-path">Makefile.in</span> in your <span class="nctnt ncbi-path">foo/c++/src/bar\_proj/</span> dir) looks like this:

    # Supply Makefile.bar_u1, Makefile.bar_u2 ...
    #
    USR_PROJ = bar_u1 bar_u2 ...

    # Supply Makefile.bar_l1.lib, Makefile.bar_l2.lib ...
    #
    LIB_PROJ = bar_l1 bar_l2 ...

    # Supply Makefile.bar_a1.app, Makefile.bar_a2.app ...
    #
    APP_PROJ = bar_a1 bar_a2 ...

    # Subprojects
    #
    SUB_PROJ = app sub_proj1 sub_proj2

    srcdir = @srcdir@
    include @builddir@/Makefile.meta

This template separately specifies instructions for user, library and application projects, along with a set of three sub-projects that can be made. The mandatory final two lines <span class="nctnt ncbi-code">"srcdir = @srcdir@; include @builddir@/Makefile.meta"</span> define the [standard build targets](#standard-build-targets).

### Makefile.in Meta Files

The <span class="nctnt ncbi-path">Makefile.in</span> meta-make file in the project's source directory defines a kind of road map that will be used by the <span class="nctnt ncbi-app">configure</span> script to generate a makefile (<span class="nctnt ncbi-path">Makefile</span>) in the corresponding directory of the <span class="nctnt ncbi-monospace">build tree</span>. <span class="nctnt ncbi-path">Makefile.in</span> does **not** participate in the actual execution of <span class="nctnt ncbi-app">make</span>, but rather, defines what will happen at that time by directing the <span class="nctnt ncbi-app">configure</span> script in the creation of the <span class="nctnt ncbi-path">Makefile</span> that will be executed (see also the description of [standard build targets](#standard-build-targets) below).

The meta-makefile <span class="nctnt ncbi-path">myProj/Makefile.in</span> should define at least one of the following macros:

-   <span class="nctnt ncbi-var">USR\_PROJ</span> (optional) - a list of names for user-defined makefiles. This macro is provided for the usage of ordinary stand-alone makefiles which do not utilize the make commands contained in additional makefiles in the top-level <span class="nctnt ncbi-path">build</span> directory. Each <span class="nctnt ncbi-monospace">p\_i</span> listed in <span class="nctnt ncbi-code">USR\_PROJ = p\_1 ... p\_N</span> must have a corresponding Makefile.p\_i in the project's source directory. When <span class="nctnt ncbi-app">make</span> is executed, the <span class="nctnt ncbi-app">make</span> directives contained in these files will be executed directly to build the targets as specified.

-   <span class="nctnt ncbi-var">LIB\_PROJ</span> (optional) - a list of names for library makefiles. For each library <span class="nctnt ncbi-monospace">l\_i</span> listed in <span class="nctnt ncbi-code">LIB\_PROJ = l\_1 ... l\_N</span>, you must have created a corresponding project makefile named Makefile.l\_i.lib in the project's source directory. When <span class="nctnt ncbi-app">make</span> is executed, these library project makefiles will be used along with <span class="nctnt ncbi-path">Makefile.lib</span> and <span class="nctnt ncbi-path">Makefile.lib.tmpl</span> (located in the top-level of the <span class="nctnt ncbi-monospace">build tree</span>) to build the specified libraries.

-   <span class="nctnt ncbi-var">ASN\_PROJ</span> (optional) is like <span class="nctnt ncbi-var">LIB\_PROJ</span>, with one additional feature: Any projects listed there will be interpreted as the names of ASN.1 module specifications to be processed by [datatool](ch_app.html#ch_app.datatool).

-   <span class="nctnt ncbi-var">APP\_PROJ</span> (optional) - a list of names for application makefiles. Similarly, each application (<span class="nctnt ncbi-monospace">p1, p2, ..., pN</span>) listed under <span class="nctnt ncbi-var">APP\_PROJ</span> must have a corresponding project makefile named <span class="nctnt ncbi-path">Makefile.p\*.app</span> in the project's source directory. When <span class="nctnt ncbi-app">make</span> is executed, these application project makefiles will be used along with <span class="nctnt ncbi-path">Makefile.app</span> and <span class="nctnt ncbi-path">Makefile.app.tmpl</span> to build the specified executables.

-   <span class="nctnt ncbi-var">SUB\_PROJ</span> (optional) - a list of names for subproject directories (used on recursive makes). The <span class="nctnt ncbi-var">SUB\_PROJ</span> macro is used to recursively define <span class="nctnt ncbi-app">make</span> targets; items listed here define the subdirectories rooted in the project's source directory where <span class="nctnt ncbi-app">make</span> should also be executed.

Some additional <span class="nctnt ncbi-monospace">meta-makefile</span> macros (listed in [Table 1](#table-1)) exist to specify various directory paths that <span class="nctnt ncbi-app">make</span> needs to know. The "@"-delimited tokens are substituted during configuration based on your environment and any command-line options passed to <span class="nctnt ncbi-app">configure</span>.

Table 1. Path Specification Makefile Macros

| Macro                                              | Source                                                                                                                           | Synopsis                                                                                                                                                         |
|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span class="nctnt ncbi-var">bindir</span>         | <span class="nctnt ncbi-var">@bindir@</span>,<br/><span class="nctnt ncbi-cmd">--bindir</span>         | Executables built inside the build tree                                                                                                                          |
| <span class="nctnt ncbi-var">build\_root</span>    | <span class="nctnt ncbi-var">@build\_root@</span>                                                                                | Path to the whole build tree                                                                                                                                     |
| <span class="nctnt ncbi-var">builddir</span>       | <span class="nctnt ncbi-var">@builddir@</span>                                                                                   | Top build directory inside the build tree                                                                                                                        |
| <span class="nctnt ncbi-var">datadir</span>        | <span class="nctnt ncbi-cmd">--datadir</span>                                                                                    | Read-only architecture-independent data                                                                                                                          |
| <span class="nctnt ncbi-var">incdir</span>         | <span class="nctnt ncbi-var">@incdir@</span>                                                                                     | Top include directory inside the build tree                                                                                                                      |
| <span class="nctnt ncbi-var">includedir</span>     | <span class="nctnt ncbi-var">@includedir@</span>,<br/><span class="nctnt ncbi-cmd">--includedir</span> | Top include directory in the source tree                                                                                                                         |
| <span class="nctnt ncbi-var">infodir</span>        | <span class="nctnt ncbi-cmd">--infodir</span>                                                                                    | Info documentation                                                                                                                                               |
| <span class="nctnt ncbi-var">libdir</span>         | <span class="nctnt ncbi-var">@libdir@</span>,<br/><span class="nctnt ncbi-cmd">--libdir</span>         | Libraries built inside the build tree                                                                                                                            |
| <span class="nctnt ncbi-var">libexecdir</span>     | <span class="nctnt ncbi-cmd">--libexecdir</span>                                                                                 | Program executables                                                                                                                                              |
| <span class="nctnt ncbi-var">localstatedir</span>  | <span class="nctnt ncbi-cmd">--localstatedir</span>                                                                              | Modifiable single-machine data                                                                                                                                   |
| <span class="nctnt ncbi-var">mandir</span>         | <span class="nctnt ncbi-cmd">--mandir</span>                                                                                     | Man documentation                                                                                                                                                |
| <span class="nctnt ncbi-var">oldincludedir</span>  | <span class="nctnt ncbi-cmd">--oldincludedir</span>                                                                              | C header files for non-gcc                                                                                                                                       |
| <span class="nctnt ncbi-var">sbindir</span>        | <span class="nctnt ncbi-cmd">--sbindir</span>                                                                                    | System admin executables                                                                                                                                         |
| <span class="nctnt ncbi-var">sharedstatedir</span> | <span class="nctnt ncbi-cmd">--sharedstatedir</span>                                                                             | Modifiable architecture-independent data                                                                                                                         |
| <span class="nctnt ncbi-var">srcdir</span>         | <span class="nctnt ncbi-var">@srcdir@</span>,<br/><span class="nctnt ncbi-cmd">--srcdir</span>         | Directory in the source tree that corresponds to the directory (<span class="nctnt ncbi-path">./</span>) in the build tree where the build is currently going on |
| <span class="nctnt ncbi-var">status\_dir</span>    | <span class="nctnt ncbi-var">@status\_dir@</span>                                                                                | Configuration status files                                                                                                                                       |
| <span class="nctnt ncbi-var">sysconfdir</span>     | <span class="nctnt ncbi-cmd">--sysconfdir</span>                                                                                 | Read-only single-machine data (default)                                                                                                                          |
| <span class="nctnt ncbi-var">top\_srcdir</span>    | <span class="nctnt ncbi-var">@top\_srcdir@</span>                                                                                | Path to the whole NCBI C++ package                                                                                                                               |

### Expendable Projects

By default, failure of any project will cause make to exit immediately. Although this behavior can save a lot of time, it is not always desirable. One way to avoid it is to run <span class="nctnt ncbi-cmd">make -k</span> rather than <span class="nctnt ncbi-cmd">make</span>, but then major problems affecting a large portion of the build will still waste a lot of time.

Consequently, the toolkit's build system supports an alternative approach: [meta-makefiles](#meta-makefiles) can define <span class="nctnt ncbi-monospace">expendable</span> projects which should be built if possible but are allowed to fail without interrupting the build. The way to do this is to list such projects in <span class="nctnt ncbi-var">EXPENDABLE\_\*\_PROJ</span> rather than <span class="nctnt ncbi-var">\*\_PROJ</span>.

Project Makefiles
-----------------

When beginning a new project, the [new\_project](ch_proj.html#ch_proj.new_project_Starting) shell script will generate an initial configured makefile, <span class="nctnt ncbi-path">Makefile.\<project\_name\>\_app</span>, that you can modify as needed. In addition, a working sample application can also be checked out to experiment with or as an alternate template.

The [import\_project](ch_getcode_svn.html#ch_getcode_svn.import_project_sh) script is useful for working on existing Toolkit projects without needing to build the whole Toolkit. In this case things are particularly straightforward as the project will be retrieved complete with its <span class="nctnt ncbi-monospace">makefile</span> already configured as <span class="nctnt ncbi-path">Makefile.\<project\_name\>\_[app\\|lib]</span>. (Note that there is an underscore in the name, not a period as in the similarly-named <span class="nctnt ncbi-monospace">customizable makefile</span> from which the configured file is derived.)

**If you are working outside of the source tree:** In this scenario you are only linking to the Toolkit libraries and will not need to run the <span class="nctnt ncbi-app">configure</span> script, so a <span class="nctnt ncbi-path">Makefile.in</span> template <span class="nctnt ncbi-monospace">meta-makefile</span> is not required. Some of the typical edits required for the <span class="nctnt ncbi-monospace">customized makefile</span> are shown in the section on [working in a separate directory](ch_proj.html#ch_proj.outside_tree_makefile).

**If you are working within the source tree or subtree:** Project subdirectories that do not contain any <span class="nctnt ncbi-path">\*.in</span> files are ignored by the <span class="nctnt ncbi-app">configure</span> script. Therefore, you will now also need to create a <span class="nctnt ncbi-monospace">meta-makefile</span> for the newly created project before configuring your <span class="nctnt ncbi-path">build</span> directory to include the new project.

Several examples are detailed on the "[Starting New Projects](ch_proj.html#ch_proj.make_proj_lib)" section.

### List of optional packages, features and projects

[Table 2](#table-2) displays the keywords you can list in <span class="nctnt ncbi-var">REQUIRES</span> in a customized [application](ch_proj.html#ch_proj.make_proj_app) or [library](ch_proj.html#ch_proj.make_proj_lib) makefile, along with the corresponding [configure options](ch_config.html#ch_config.ch_configprohibit_sy):

Table 2. Optional Packages, Features, and Projects

| Keyword                                          | Optional ...                                 | Configure options                                                                                                                                                                                                                      |
|--------------------------------------------------|----------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                              |                          |                                                                                                                                                                                                                    |
|                              | **... packages**                             |                                                                                                                                                                                                                    |
| <span class="nctnt ncbi-code">C-Toolkit</span>   | NCBI C Toolkit                               | <span class="nctnt ncbi-cmd">--without-ncbi-c</span>                                                                                                                                                                                   |
| <span class="nctnt ncbi-code">Fast-CGI</span>    | Fast-CGI library                             | <span class="nctnt ncbi-cmd">--without-fastcgi</span>                                                                                                                                                                                  |
| <span class="nctnt ncbi-code">FLTK</span>        | the Fast Light ToolKit                       | <span class="nctnt ncbi-cmd">--without-fltk,</span><br/><span class="nctnt ncbi-cmd">--with-fltk=DIR</span>                                                                                                  |
| <span class="nctnt ncbi-code">FreeTDS</span>     | FreeTDS libraries                            | <span class="nctnt ncbi-cmd">--without-ftds,</span><br/><span class="nctnt ncbi-cmd">--with-ftds=DIR</span>                                                                                                  |
| <span class="nctnt ncbi-code">GEO</span>         | NCBI GEO libraries                           | <span class="nctnt ncbi-cmd">--without-geo</span>                                                                                                                                                                                      |
| <span class="nctnt ncbi-code">ORBacus</span>     | ORBacus CORBA                                | <span class="nctnt ncbi-cmd">--without-orbacus,</span><br/><span class="nctnt ncbi-cmd">--with-orbacus=DIR</span>                                                                                            |
| <span class="nctnt ncbi-code">PubMed</span>      | NCBI PubMed libraries                        | <span class="nctnt ncbi-cmd">--without-pubmed</span>                                                                                                                                                                                   |
| <span class="nctnt ncbi-code">SP</span>          | SP libraries                                 | <span class="nctnt ncbi-cmd">--without-sp</span>                                                                                                                                                                                       |
| <span class="nctnt ncbi-code">SSSDB</span>       | NCBI SSS DB library                          | <span class="nctnt ncbi-cmd">--without-sssdb,</span><br/><span class="nctnt ncbi-cmd">--without-sss</span>                                                                                                   |
| <span class="nctnt ncbi-code">SSSUTILS</span>    | NCBI SSS UTILS library                       | <span class="nctnt ncbi-cmd">--without-sssutils,</span><br/><span class="nctnt ncbi-cmd">--without-sss</span>                                                                                                |
| <span class="nctnt ncbi-code">Sybase</span>      | Sybase libraries                             | <span class="nctnt ncbi-cmd">--without-sybase,</span><br/><span class="nctnt ncbi-cmd">--with-sybase-local(=DIR),</span><br/><span class="nctnt ncbi-cmd">--with-sybase-new</span> |
| <span class="nctnt ncbi-code">wxWindows</span>   | wxWindows                                    | <span class="nctnt ncbi-cmd">--without-wxwin,</span><br/><span class="nctnt ncbi-cmd">--with-wxwin=DIR</span>                                                                                                |
|                              |                          |                                                                                                                                                                                                                    |
|                              | **... features**                             |                                                                                                                                                                                                                    |
| <span class="nctnt ncbi-code">MT</span>          | multithreading is available                  | <span class="nctnt ncbi-cmd">--with-mt</span>                                                                                                                                                                                          |
|                              |                          |                                                                                                                                                                                                                    |
|                              | **... projects**                             |                                                                                                                                                                                                                    |
| <span class="nctnt ncbi-code">app</span>         | standalone applications like ID1\_FETCH      | <span class="nctnt ncbi-cmd">--with-app</span>                                                                                                                                                                                         |
| <span class="nctnt ncbi-code">ctools</span>      | projects based on the NCBI C toolkit         | <span class="nctnt ncbi-cmd">--without-ctools</span>                                                                                                                                                                                   |
| <span class="nctnt ncbi-code">gui</span>         | projects that use the wxWindows GUI package  | <span class="nctnt ncbi-cmd">--without-gui</span>                                                                                                                                                                                      |
| <span class="nctnt ncbi-code">internal</span>    | all internal projects                        | <span class="nctnt ncbi-cmd">--with-internal</span>                                                                                                                                                                                    |
| <span class="nctnt ncbi-code">objects</span>     | libraries to serialize ASN.1/XML objects     | <span class="nctnt ncbi-cmd">--with-objects</span>                                                                                                                                                                                     |
| <span class="nctnt ncbi-code">serial</span>      | ASN.1/XML serialization library and datatool | <span class="nctnt ncbi-cmd">--without-serial</span>                                                                                                                                                                                   |
| <span class="nctnt ncbi-code">local\_lbsm</span> | IPC with locally running LBSMD               | <span class="nctnt ncbi-cmd">--without-local-lbsm</span>                                                                                                                                                                               |

Standard Build Targets
----------------------

The following topics are discussed in this section:

-   [Meta-Makefile Targets](#meta-makefile-targets)

-   [Makefile Targets](#makefile-targets)

### Meta-Makefile Targets

The mandatory lines from the [meta-makefile example above](#meta-makefile-example-above),

    srcdir = @srcdir@
    include @builddir@/Makefile.meta

provide the build rules for the following standard meta-makefile targets:

-   <span class="nctnt ncbi-monospace">all</span>:

    -   Run <span class="nctnt ncbi-cmd">"make -f {Makefile.\*} all"</span> for the makefiles with the suffixes listed in macro <span class="nctnt ncbi-var">USR\_PROJ</span>:<br/><span class="nctnt ncbi-code">make -f Makefile.bar\_u1 all</span><br/><span class="nctnt ncbi-code">make -f Makefile.bar\_u2 all</span><br/><span class="nctnt ncbi-code">...</span>

    -   Build libraries using attributes defined in the customized makefiles <span class="nctnt ncbi-path">Makefile.\*.lib</span> with the suffixes listed in macro <span class="nctnt ncbi-var">LIB\_PROJ</span>.

    -   Build application(s) using attributes defined in the customized makefiles <span class="nctnt ncbi-path">Makefile.\*.app</span> with the suffixes listed in macro <span class="nctnt ncbi-var">APP\_PROJ</span>.

-   <span class="nctnt ncbi-monospace">all\_r</span>:

    -   First make target <span class="nctnt ncbi-cmd">all</span>, then run <span class="nctnt ncbi-cmd">"make all\_r"</span> in all subdirectories enlisted in <span class="nctnt ncbi-var">$(SUB\_PROJ)</span>:<br/><span class="nctnt ncbi-code">cd bar\_test</span><br/><span class="nctnt ncbi-code">make -f Makefile all\_r</span><br/><span class="nctnt ncbi-code">cd bar\_sub\_proj1</span><br/><span class="nctnt ncbi-code">make -f Makefile all\_r</span><br/><span class="nctnt ncbi-code">...</span>

-   <span class="nctnt ncbi-monospace">clean</span>, <span class="nctnt ncbi-monospace">clean\_r</span>:

    -   Run the same makefiles but with targets <span class="nctnt ncbi-cmd">clean</span> and <span class="nctnt ncbi-cmd">clean\_r</span> (rather than <span class="nctnt ncbi-cmd">all</span> and <span class="nctnt ncbi-cmd">all\_r</span>), respectively.

-   <span class="nctnt ncbi-monospace">purge</span>, <span class="nctnt ncbi-monospace">purge\_r</span>:

    -   Run the same makefiles but with targets <span class="nctnt ncbi-cmd">purge</span> and <span class="nctnt ncbi-cmd">purge\_r</span>.

### Makefile Targets

The standard build targets for Toolkit makefiles are <span class="nctnt ncbi-cmd">all, clean</span> and <span class="nctnt ncbi-cmd">purge</span>. Recall that recursive versions of these targets exist for meta-makefiles.

-   <span class="nctnt ncbi-cmd">all</span>:

    -   Compile the object modules specified in the <span class="nctnt ncbi-var">"$(OBJ)"</span> macro, and use them to build the library <span class="nctnt ncbi-var">"$(LIB)"</span> or the application <span class="nctnt ncbi-var">"$(APP)"</span>; then copy the resultant [<span class="nctnt ncbi-path">lib\\|app</span>] to the [[libdir\\|bindir](#libdir|bindir)] directory, respectively.

-   <span class="nctnt ncbi-cmd">clean</span>:

    -   Remove all object modules and libs/apps that have been built by <span class="nctnt ncbi-cmd">all</span>.

-   <span class="nctnt ncbi-cmd">purge</span>:

    -   Do <span class="nctnt ncbi-cmd">clean</span>, and then remove the copy of the [<span class="nctnt ncbi-path">libs\\|apps</span>] from the [[libdir\\|bindir](#libdir|bindir)] directory.

The customized makefiles do not distinguish between recursive (<span class="nctnt ncbi-cmd">all\_r, clean\_r, purge\_r</span>) and non-recursive (<span class="nctnt ncbi-cmd">all, clean, purge</span>) targets -- because the recursion and multiple build is entirely up to the [meta-makefiles](#meta-makefiles).

Makefile Macros and <span class="nctnt ncbi-path">Makefile.mk</span>
--------------------------------------------------------------------

There is a wide assortment of configured tools, flags, third party packages and [paths (see above)](#paths-see-above). They can be specified for the whole build tree with the appropriate entry in <span class="nctnt ncbi-path">Makefile.mk</span>, which is silently included at the very beginning of the customized makefiles used to build [libraries](ch_proj.html#ch_proj.make_proj_lib) and [applications](ch_proj.html#ch_proj.make_proj_app).

Many makefile macros are supplied with defaults <span class="nctnt ncbi-var">ORIG\_\*</span> in <span class="nctnt ncbi-path">Makefile.mk</span>. See the list of <span class="nctnt ncbi-var">ORIG\_\*</span> macros, and all others currently defined, in the [Makefile.mk.in](http://www.ncbi.nlm.nih.gov/IEB/ToolBox/CPP_DOC/lxr/source/src/build-system/Makefile.mk.in) template for details. One should not override these defaults in normal use, but add your own flags to them as needed in the corresponding working macro; e.g., set <span class="nctnt ncbi-code">CXX = $(ORIG\_CXX) -DFOO\_BAR</span>.

<span class="nctnt ncbi-path">Makefile.mk</span> defines makefile macros obtained during the configuration process for flags (see[Table 3](#table-3)), system and third-party packages (see [Table 4](#table-4)) and development tools (see [Table 5](#table-5)).

Table 3. Flags

| Macro                                              | [Source](ch_config.html#ch_config.ref_TableToolsAndFlags) | [Synopsis](ch_config.html#ch_config.ch_configconfig_flag)                                  |
|----------------------------------------------------|-----------------------------------------------------------|--------------------------------------------------------------------------------------------|
| <span class="nctnt ncbi-var">APP\_LDFLAGS</span>   | compiler test                                             | Compiler-dependent variaton on <span class="nctnt ncbi-var">LDFLAGS</span>                 |
| <span class="nctnt ncbi-var">CFLAGS</span>         | <span class="nctnt ncbi-var">$CFLAGS</span>               | C compiler flags                                                                           |
| <span class="nctnt ncbi-var">CPPFLAGS</span>       | <span class="nctnt ncbi-var">$CPPFLAGS</span>             | C/C++ preprocessor flags                                                                   |
| <span class="nctnt ncbi-var">CXXFLAGS</span>       | <span class="nctnt ncbi-var">$CXXFLAGS</span>             | C++ compiler flags                                                                         |
| <span class="nctnt ncbi-var">DEPFLAGS</span>       | <span class="nctnt ncbi-var">$DEPFLAGS</span>             | Flags for file dependency lists                                                            |
| <span class="nctnt ncbi-var">DEPFLAGS\_POST</span> | compiler test                                             | Related to VisualAge (retained for historical reasons)                                     |
| <span class="nctnt ncbi-var">DLL\_LDFLAGS</span>   | compiler test                                             | Compiler-dependent variaton on <span class="nctnt ncbi-var">LDFLAGS</span>                 |
| <span class="nctnt ncbi-var">FAST\_CFLAGS</span>   | <span class="nctnt ncbi-var">$FAST\_CFLAGS</span>         | [(\*)](#*) C compiler flags to generate faster code                                        |
| <span class="nctnt ncbi-var">FAST\_CXXFLAGS</span> | <span class="nctnt ncbi-var">$FAST\_CXXFLAGS</span>       | [(\*)](#*) C++ compiler flags to generate faster code                                      |
| <span class="nctnt ncbi-var">LDFLAGS</span>        | <span class="nctnt ncbi-var">$LDFLAGS</span>              | Linker flags                                                                               |
| <span class="nctnt ncbi-var">LIB\_OR\_DLL</span>   | <span class="nctnt ncbi-var">@LIB\_OR\_DLL@</span>        | Specify whether to build a library as static or dynamic                                    |
| <span class="nctnt ncbi-var">STATIC</span>         | <span class="nctnt ncbi-var">@STATIC@</span>              | Library suffix to force static linkage (see [example](ch_proj.html#ch_proj.make_proj_app)) |

Table 4. System and third-party packages

| Macro                                                  | Source                                                  | Synopsis                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|--------------------------------------------------------|---------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span class="nctnt ncbi-var">FASTCGI\_INCLUDE</span>   | <span class="nctnt ncbi-var">$FASTCGI\_INCLUDE</span>   | Fast-CGI headers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span class="nctnt ncbi-var">FASTCGI\_LIBS</span>      | <span class="nctnt ncbi-var">$FASTCGI\_LIBS</span>      | Fast-CGI libraries                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| <span class="nctnt ncbi-var">KSTAT\_LIBS</span>        | <span class="nctnt ncbi-var">$KSTAT\_LIBS</span>        | KSTAT library (system)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span class="nctnt ncbi-var">LIBS</span>               | <span class="nctnt ncbi-var">$LIBS</span>               | Default libraries to link with                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span class="nctnt ncbi-var">MATH\_LIBS</span>         | <span class="nctnt ncbi-var">$MATH\_LIBS</span>         | Math library (system)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <span class="nctnt ncbi-var">NETWORK\_LIBS</span>      | <span class="nctnt ncbi-var">$NETWORK\_LIBS</span>      | Network library (system)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span class="nctnt ncbi-var">NCBI\_C\_INCLUDE</span>   | <span class="nctnt ncbi-var">$NCBI\_C\_INCLUDE</span>   | NCBI C toolkit headers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span class="nctnt ncbi-var">NCBI\_C\_LIBPATH</span>   | <span class="nctnt ncbi-var">$NCBI\_C\_LIBPATH</span>   | Path to the NCBI C Toolkit libraries                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span class="nctnt ncbi-var">NCBI\_C\_ncbi</span>      | <span class="nctnt ncbi-var">$NCBI\_C\_ncbi</span>      | NCBI C CoreLib                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span class="nctnt ncbi-var">NCBI\_PM\_PATH</span>     | <span class="nctnt ncbi-var">$NCBI\_PM\_PATH</span>     | Path to the PubMed package                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <span class="nctnt ncbi-var">NCBI\_SSS\_INCLUDE</span> | <span class="nctnt ncbi-var">$NCBI\_SSS\_INCLUDE</span> | NCBI SSS headers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span class="nctnt ncbi-var">NCBI\_SSS\_LIBPATH</span> | <span class="nctnt ncbi-var">$NCBI\_SSS\_LIBPATH</span> | Path to NCBI SSS libraries                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <span class="nctnt ncbi-var">ORBACUS\_INCLUDE</span>   | <span class="nctnt ncbi-var">$ORBACUS\_LIBPATH</span>   | Path to the ORBacus CORBA headers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span class="nctnt ncbi-var">ORBACUS\_LIBPATH</span>   | <span class="nctnt ncbi-var">$ORBACUS\_LIBPATH</span>   | Path to the ORBacus CORBA libraries                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| <span class="nctnt ncbi-var">PRE\_LIBS</span>          | <span class="nctnt ncbi-var">$PRE\_LIBS</span>          | Use <span class="nctnt ncbi-var">PRE\_LIBS</span> to place specific libraries or library directories earlier in the link command line than the standard libraries or directories (i.e. to precede <span class="nctnt ncbi-var">$LIBS</span>). For example, if you wanted to link with your custom library <span class="nctnt ncbi-path">mylib/libmylib.a</span> and also use a locally modified version of an NCBI library saved in a directory called <span class="nctnt ncbi-path">ncbilibs</span> you could use a <span class="nctnt ncbi-var">PRE\_LIBS</span> macro similar to:<br/><span class="nctnt ncbi-monospace">PRE\_LIBS = -lmylib/mylib -Lncbilibs</span> |
| <span class="nctnt ncbi-var">RPCSVC\_LIBS</span>       | <span class="nctnt ncbi-var">$RPCSVC\_LIBS</span>       | RPCSVC library (system)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span class="nctnt ncbi-var">SYBASE\_INCLUDE</span>    | <span class="nctnt ncbi-var">$SYBASE\_INCLUDE</span>    | SYBASE headers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span class="nctnt ncbi-var">SYBASE\_LIBS</span>       | <span class="nctnt ncbi-var">$SYBASE\_LIBS</span>       | SYBASE libraries                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span class="nctnt ncbi-var">THREAD\_LIBS</span>       | <span class="nctnt ncbi-var">$THREAD\_LIBS</span>       | Thread library (system)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

<span class="nctnt highlight">Note:</span> The values of the user-specified environment variables <span class="nctnt ncbi-var">$FAST\_CFLAGS</span> and <span class="nctnt ncbi-var">$FAST\_CXXFLAGS</span> will substitute the regular optimization flag <span class="nctnt ncbi-cmd">-O</span> (or <span class="nctnt ncbi-cmd">-O2</span>, etc.). For example, if in the environment: <span class="nctnt ncbi-var">$FAST\_CXXFLAGS</span>=<span class="nctnt ncbi-monospace">-fast -speedy</span> and <span class="nctnt ncbi-var">$CXXFLAGS</span>=<span class="nctnt ncbi-monospace">-warn -O3 -std</span>, then in makefile: <span class="nctnt ncbi-var">$(FAST\_CXXFLAGS)</span>=<span class="nctnt ncbi-monospace">-warn -fast -speedy -std</span>.

Example Makefiles
-----------------

Below are links to examples of typical <span class="nctnt ncbi-monospace">makefiles</span>, complete with descriptions of their content.

-   Inside the Tree

    -   [An example meta-makefile and its associated project makefiles](ch_proj.html#ch_proj.inside_example)

    -   [Library project makefile: Makefile.myProj.lib](ch_proj.html#ch_proj.inside_lib_make)

    -   [Application project makefile: Makefile.myProj.app](ch_proj.html#ch_proj.inside_app_make)

    -   [Custom project makefile: Makefile.myProj](ch_proj.html#ch_proj.inside_cust_make)

-   New Projects and Outside the Tree

    -   [Use Shell Scripts to Create Makefiles](ch_proj.html#ch_proj.new_project_Starting)

    -   [Customized makefile to build a library](ch_proj.html#ch_proj.make_proj_lib)

    -   [Customized makefile to build an application](ch_proj.html#ch_proj.make_proj_app)

    -   [User-defined makefile to build... whatever](ch_proj.html#ch_proj.usr_def_makefile)


